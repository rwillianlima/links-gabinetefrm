<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Pesquisa de JurisprudÃªncia â€“ Gabinete Des. F. R. Montefusco</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:#174b73;color:#fff;margin:0;}
  #sidebar{position:fixed;top:0;left:0;width:240px;height:100%;background:#0b2f4d;padding-top:60px;box-shadow:2px 0 6px rgba(0,0,0,.3);}  
  #sidebar a{display:block;padding:12px 20px;color:#fff;text-decoration:none;font-size:1rem;}
  #sidebar a:hover{background:#105b8e;}
  #content{margin-left:260px;padding:40px 20px;min-height:100vh;}
  #content h1{font-size:2rem;margin-bottom:20px;text-align:center;}
  .search-bar{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-bottom:25px;}
  .search-bar input[type="text"],.search-bar input[type="date"]{padding:8px;border:none;border-radius:4px;width:200px;max-width:90%;}
  .search-bar button{padding:8px 18px;border:none;border-radius:4px;background:#0b2f4d;color:#fff;font-weight:bold;cursor:pointer;}
  .search-bar button:hover{background:#105b8e;}
  .block{background:#0b2f4d;border-radius:6px;padding:16px;margin:10px auto;max-width:900px;display:none;}
  .block h3{margin:0 0 6px 0;font-size:1.05rem;color:#fff;}
  .block p{margin:4px 0 0 0;font-size:.9rem;line-height:1.3;white-space:pre-wrap;}
  .pagination{display:flex;justify-content:center;gap:6px;margin:20px 0;}
  .pagination button{background:#0b2f4d;border:none;border-radius:4px;color:#fff;padding:6px 12px;cursor:pointer;}
  .pagination button.active{background:#105b8e;font-weight:bold;}
</style>
<!-- PapaParse para ler TSV -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>

<div id="sidebar">
  <a href="index.html" rel="noopener noreferrer">ðŸ”™ Voltar Ã  PÃ¡gina Inicial</a>
</div>

<div id="content">
  <h1>ðŸ”Ž Pesquisa AvanÃ§ada de JurisprudÃªncia</h1>

  <div class="search-bar">
    <input type="text" id="terms" placeholder="Digite termos (separados por espaÃ§o)">
    <input type="date" id="startDate">
    <input type="date" id="endDate">
    <button onclick="performSearch()">Consultar</button>
  </div>

  <div id="allBlocks"><!-- preenchido via JS --></div>
  <div id="pagination" class="pagination"></div>
</div>

<script>
const TSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTCwzKKtRs5uQ56A6GCx6FPVSKU8mTXxowFrVpJ1XjHLagJw-pA2ks46MO0b06TtEqZgbx7UJRvY1Hu/pub?gid=0&single=true&output=tsv';
const PAGE_SIZE = 50;
let currentResults = [];
let currentPage   = 1;

async function loadTSV(){
  try{
    const res  = await fetch(TSV_URL);
    const text = await res.text();
    const dados = Papa.parse(text,{header:true,delimiter:'\t',skipEmptyLines:true}).data;
    const cont  = document.getElementById('allBlocks');
    cont.innerHTML='';
    dados.forEach(l=>{
      if(!l.date||!l.body) return; // pula linhas vazias
      const div = document.createElement('div');
      div.className = 'block';
      div.setAttribute('data-date', l.date.trim());
      const titulo = l.title && l.title.trim() ? l.title.trim() : `DecisÃ£o â€“ ${l.date.trim()}`;
      div.innerHTML = `<h3>${titulo}</h3><p>${l.body.trim()}</p>`;
      cont.appendChild(div);
    });
    currentResults = Array.from(document.querySelectorAll('#allBlocks .block'));
    renderPage();
  }catch(err){
    console.error('Erro ao carregar TSV', err);
  }
}

function performSearch(){
  const terms = document.getElementById('terms').value.trim().toLowerCase().split(/\s+/).filter(Boolean);
  const start = document.getElementById('startDate').value;
  const end   = document.getElementById('endDate').value;
  currentResults = Array.from(document.querySelectorAll('#allBlocks .block')).filter(block=>{
    const text = block.textContent.toLowerCase();
    const date = block.getAttribute('data-date');
    const termMatch  = terms.every(t=>text.includes(t));
    const afterStart = !start || date >= start;
    const beforeEnd  = !end   || date <= end;
    return termMatch && afterStart && beforeEnd;
  });
  currentPage = 1;
  renderPage();
}

function renderPage(){
  const blocks = Array.from(document.querySelectorAll('#allBlocks .block'));
  blocks.forEach(b=>b.style.display='none');
  const totalPages = Math.max(1, Math.ceil(currentResults.length / PAGE_SIZE));
  const ini        = (currentPage-1)*PAGE_SIZE;
  currentResults.slice(ini, ini+PAGE_SIZE).forEach(b=>b.style.display='block');
  const pag = document.getElementById('pagination');
  pag.innerHTML='';
  if(totalPages>1){
    for(let i=1;i<=totalPages;i++){
      const btn=document.createElement('button');
      btn.textContent=i;
      if(i===currentPage) btn.classList.add('active');
      btn.onclick=()=>{currentPage=i;renderPage();};
      pag.appendChild(btn);
    }
  }
}

window.onload = loadTSV;
</script>
</body>
</html>
