<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Pesquisa de JurisprudÃªncia â€“ 6Âª CÃ¢mara CÃ­vel</title>
<style>
  body {
    font-family: Arial, Helvetica, sans-serif;
    background: #f4f4f4;
    color: #222;
    margin: 0;
  }

  /* Sidebar */
  #sidebar {
    position: fixed;
    top: 0;
    left: 0;
    width: 240px;
    height: 100%;
    background: #2f4050;
    box-shadow: 2px 0 6px rgba(0,0,0,.2);
    display: flex;
    flex-direction: column;
  }
  #sidebar a {
    display: block;
    padding: 12px 20px;
    color: #fff;
    text-decoration: none;
    font-size: 1rem;
  }
  #sidebar a:hover {
    background: #3b5165;
  }
  
  /* RelÃ³gio na sidebar */
  #clock {
    margin-top: auto;
    padding: 15px 20px;
    color: #fff;
    font-size: 0.9rem;
    border-top: 1px solid #3b5165;
    background: #263340;
  }
  #clock-time {
    font-size: 1.2rem;
    font-weight: bold;
    margin-bottom: 5px;
  }
  #clock-date {
    font-size: 0.85rem;
    opacity: 0.8;
  }

  /* Content */
  #content {
    margin-left: 260px;
    padding: 40px 25px;
    min-height: 100vh;
    text-align: center;
    color: #222;
  }
  #content h1 {
    font-size: 2rem;
    margin-bottom: 8px;
    color: #2f4050;
  }
  .subtitle {
    font-size: 1.1rem;
    color: #444;
    margin-bottom: 5px;
  }
  .dataset-info {
    font-size: .92rem;
    color: #666;
    margin: 2px auto 18px auto;
    max-width: 920px;
  }
  .notice {
    font-size: .85rem;
    margin-bottom: 6px;
    color: #333;
  }

  /* Search */
  .search-bar {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    margin: 10px auto;
  }
  .search-bar input,
  .search-bar select {
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    width: 200px;
    max-width: 90%;
    background: #fff;
    color: #222;
  }
  .search-bar button {
    padding: 8px 18px;
    border: none;
    border-radius: 4px;
    background: #2f4050;
    color: #fff;
    font-weight: bold;
    cursor: pointer;
    min-width: 80px;
  }
  .search-bar button:hover {
    background: #3b5165;
  }
  .opts {
    display: flex;
    align-items: center;
    gap: 12px;
    color: #444;
    font-size: .9rem;
  }
  .opts label {
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
  }

  /* Help */
  .help {
    max-width: 920px;
    margin: 10px auto 0 auto;
    text-align: left;
    background: #fff;
    border: 1px solid #ddd;
    padding: 12px 16px;
    border-radius: 6px;
    font-size: .92rem;
    line-height: 1.45;
    color: #222;
  }
  .help code {
    background: rgba(0,0,0,.05);
    padding: 0 4px;
    border-radius: 3px;
  }
  .help summary {
    cursor: pointer;
    font-weight: 700;
  }

  /* Result count */
  #resultCount {
    font-size: .95rem;
    margin: 10px auto;
    max-width: 900px;
    text-align: left;
    color: #222;
    display: none;
  }

  /* Blocks */
  .block {
    background: #fff;
    border-radius: 6px;
    padding: 16px;
    margin: 10px auto;
    max-width: 900px;
    display: none;
    position: relative;
    border: 1px solid #ddd;
  }
  .block p {
    margin: 4px 0 0 0;
    font-size: .9rem;
    line-height: 1.45;
    color: #222;
    text-align: justify;
  }
  .type {
    margin-top: 6px;
    font-size: .85rem;
    color: #666;
    text-align: center;
  }
  .meta {
    margin-top: 8px;
    font-size: .85rem;
    color: #666;
    text-align: center;
  }

  /* Copy button (em cada bloco) */
  .copy-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    border: none;
    border-radius: 4px;
    padding: 6px 10px;
    background: #2f4050;
    color: #fff;
    cursor: pointer;
    font-size: .8rem;
  }
  .copy-btn:hover {
    background: #3b5165;
  }

  /* Pagination */
  .pagination {
    display: none;
    justify-content: center;
    gap: 6px;
    margin: 20px auto;
    max-width: 900px;
    flex-wrap: wrap;
  }
  .pagination button {
    background: #2f4050;
    border: none;
    border-radius: 4px;
    color: #fff;
    padding: 6px 12px;
    cursor: pointer;
  }
  .pagination button.active {
    background: #1c87c9;
    font-weight: bold;
  }
  .pagination button[disabled] {
    opacity: .5;
    cursor: not-allowed;
  }

  /* ContÃªiner de resultados (oculto atÃ© a busca) */
  #allBlocks {
    display: none;
  }

  /* Destaque dos termos encontrados */
  mark {
    background: #ffeb3b;
    color: #000;
    font-weight: bold;
    padding: 0 2px;
    border-radius: 2px;
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
<div id="sidebar">
  <a href="index.html" rel="noopener noreferrer">ðŸ”™ Voltar Ã  PÃ¡gina Inicial</a>
  <div id="clock">
    <div id="clock-time">--:--:--</div>
    <div id="clock-date">--/--/----</div>
  </div>
</div>

<div id="content">
  <h1>ðŸ”Ž Pesquisa de JurisprudÃªncia</h1>
  <div class="subtitle">6Âª CÃ¢mara CÃ­vel - A partir de 2024</div>
  <div id="datasetInfo" class="dataset-info">Carregando informaÃ§Ãµes do banco de dadosâ€¦</div>

  <p class="notice">
    Use <strong>aspas</strong> para frases exatas (sem curingas); <strong>;</strong> ou <strong>AND</strong> para termos obrigatÃ³rios; 
    <strong>OR</strong> para alternÃ¢ncia; <strong>-</strong> ou <strong>NOT</strong> para excluir; 
    <strong>*</strong> como curinga <u>apenas fora</u> das aspas. ParÃªnteses sÃ£o aceitos. Acentos sÃ£o ignorados.
  </p>

  <div class="search-bar">
    <input type="text" id="terms" placeholder='Ex.: BACEN; ("dano moral" OR "dano extrapatrimonial") ; responsabilidade'>
    <input type="date" id="startDate">
    <input type="date" id="endDate">
    <select id="relator">
      <option value="">Relator (todos)</option>
    </select>
    <div class="opts">
      <label><input type="checkbox" id="fuzzy"> Fuzzy (aproximaÃ§Ãµes)</label>
    </div>
    <button onclick="performSearch()">Consultar</button>
  </div>

  <!-- Ajuda ao usuÃ¡rio -->
  <div class="help" id="helpBox">
    <details>
      <summary>Como pesquisar (clique para expandir)</summary>
      <div style="margin-top:10px">
        <p><strong>Exato com aspas</strong>: <code>"erro material"</code></p>
        <p><strong>AND</strong>: <code>termo1;termo2</code> ou <code>termo1 AND termo2</code></p>
        <p><strong>OR</strong>: <code>clÃ¡usulaA OR clÃ¡usulaB</code></p>
        <p><strong>NOT</strong>: <code>-termo</code> ou <code>NOT termo</code></p>
        <p><strong>ParÃªnteses</strong>: <code>BACEN; ("dano moral" OR "dano extrapatrimonial") ; responsabilidade</code></p>
        <p><strong>Curinga *</strong>: <code>contrat*</code> encontra "contrato", "contratual"</p>
        <p><strong>Fuzzy</strong>: marque "Fuzzy" para aceitar pequenas variaÃ§Ãµes.</p>
        <p style="margin-top:8px;color:#666">Dica: acentos sÃ£o ignorados tanto na busca quanto no destaque.</p>
      </div>
    </details>
  </div>

  <div id="resultCount"></div>
  <div id="allBlocks"></div>
  <div id="pagination" class="pagination"></div>
</div>

<script>
let dataset = [];
let filteredData = [];
let lastUpdate = '';

// Atualizar relÃ³gio
function updateClock() {
  const now = new Date();
  const timeString = now.toLocaleTimeString('pt-BR');
  const dateString = now.toLocaleDateString('pt-BR', { 
    weekday: 'long', 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
  });
  
  document.getElementById('clock-time').textContent = timeString;
  document.getElementById('clock-date').textContent = dateString;
}

// Carregar dados da planilha
function loadDataset() {
  const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTCwzKKtRs5uQ56A6GCx6FPVSKU8mTXxowFrVpJ1XjHLagJw-pA2ks46MO0b06TtEqZgbx7UJRvY1Hu/pub?output=csv';
  
  Papa.parse(csvUrl, {
    download: true,
    header: true,
    complete: function(results) {
      dataset = results.data.filter(item => Object.keys(item).length > 0);
      updateDatasetInfo();
      populateFilters();
    },
    error: function(error) {
      document.getElementById('datasetInfo').textContent = 'Erro ao carregar dados';
      console.error('Erro:', error);
    }
  });
}

function updateDatasetInfo() {
  const info = document.getElementById('datasetInfo');
  
  // Encontrar a Ãºltima data na planilha
  let latestDate = '';
  dataset.forEach(item => {
    if (item.data && item.data > latestDate) {
      latestDate = item.data;
    }
  });
  
  lastUpdate = latestDate;
  
  const updateText = lastUpdate ? `Ãšltima atualizaÃ§Ã£o: ${formatDate(lastUpdate)}` : '';
  info.textContent = `Banco de dados: ${dataset.length} registros da 6Âª CÃ¢mara CÃ­vel. ${updateText}`;
}

function formatDate(dateString) {
  if (!dateString) return '';
  
  try {
    const parts = dateString.split('/');
    if (parts.length === 3) {
      return `${parts[0]}/${parts[1]}/${parts[2]}`;
    }
    
    // Tentar outros formatos de data
    const date = new Date(dateString);
    if (!isNaN(date.getTime())) {
      return date.toLocaleDateString('pt-BR');
    }
    
    return dateString;
  } catch (e) {
    return dateString;
  }
}

function populateFilters() {
  // Preencher filtro de relatores com valores Ãºnicos
  const relators = [...new Set(dataset.map(item => item.relator))].filter(Boolean);
  populateSelect('relator', relators);
}

function populateSelect(selectId, options) {
  const select = document.getElementById(selectId);
  
  // Limpar opÃ§Ãµes existentes (exceto a primeira)
  while (select.children.length > 1) {
    select.removeChild(select.lastChild);
  }
  
  options.sort().forEach(option => {
    const opt = document.createElement('option');
    opt.value = option;
    opt.textContent = option;
    select.appendChild(opt);
  });
}

function performSearch() {
  const searchTerms = document.getElementById('terms').value;
  const startDate = document.getElementById('startDate').value;
  const endDate = document.getElementById('endDate').value;
  const relator = document.getElementById('relator').value;
  const useFuzzy = document.getElementById('fuzzy').checked;
  
  // Implementar lÃ³gica de busca aqui
  console.log('Busca realizada:', { searchTerms, startDate, endDate, relator, useFuzzy });
  
  // Exemplo de resultado (substituir pela lÃ³gica real)
  displayResults(dataset.slice(0, 5));
}

function displayResults(results) {
  const allBlocks = document.getElementById('allBlocks');
  const resultCount = document.getElementById('resultCount');
  const pagination = document.getElementById('pagination');
  
  // Limpar resultados anteriores
  allBlocks.innerHTML = '';
  
  if (results.length === 0) {
    resultCount.textContent = 'Nenhum resultado encontrado.';
    resultCount.style.display = 'block';
    allBlocks.style.display = 'none';
    pagination.style.display = 'none';
    return;
  }
  
  resultCount.textContent = `${results.length} resultado(s) encontrado(s).`;
  resultCount.style.display = 'block';
  allBlocks.style.display = 'block';
  
  // Exibir resultados (exemplo)
  results.forEach((item, index) => {
    const block = document.createElement('div');
    block.className = 'block';
    block.style.display = 'block';
    
    block.innerHTML = `
      <button class="copy-btn" onclick="copyToClipboard(${index})">Copiar</button>
      <p><strong>${item.ementa || 'Sem ementa'}</strong></p>
      <div class="meta">
        ${item.data ? `Data: ${item.data}` : ''} 
        ${item.relator ? ` | Relator: ${item.relator}` : ''}
        ${item.processo ? ` | Processo: ${item.processo}` : ''}
      </div>
    `;
    
    allBlocks.appendChild(block);
  });
  
  // Configurar paginaÃ§Ã£o (simplificado)
  pagination.style.display = 'flex';
}

function copyToClipboard(index) {
  // Implementar funÃ§Ã£o de copiar
  alert(`ConteÃºdo ${index + 1} copiado para a Ã¡rea de transferÃªncia!`);
}

// Inicializar
document.addEventListener('DOMContentLoaded', function() {
  loadDataset();
  updateClock();
  setInterval(updateClock, 1000);
});
</script>
</body>
</html>
