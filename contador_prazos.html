<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Contador de Prazos Cíveis — TJGO (2023–2026)</title>
  <style>
    :root{
      --paper:#f8f6f2; --paper-3:#eee9e1; --card:#ffffff;
      --ink:#2b2b2b; --sepia:#7a6f61; --graphite:#3a3a3a;
      --line:#e3ded6; --line-2:#d8d1c4;
      --useful:#4d6b4d; --holiday:#7a6f61; --recess:#6a1f1f; --ash:#8a6d3b;
      --row:#fbf9f5; --row2:#f5f1ea; --hl:#f1ede5; --bad:var(--recess);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--paper); color:var(--ink);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }

    /* ===== LAYOUT DESKTOP ===== */
    .desktop-layout {
      display: none;
    }

    /* Sidebar fixa de retorno */
    #sidebar-back{
      position:fixed; top:0; left:0; width:200px; height:100%;
      background:var(--graphite); color:white; display:flex; flex-direction:column;
      padding-top:10px; box-shadow:2px 0 6px rgba(0,0,0,.25); z-index:30;
    }
    #sidebar-back a{
      display:block; padding:12px 18px; color:white; text-decoration:none; font-weight:600;
      border-left:3px solid transparent; transition:background .2s ease;
    }
    #sidebar-back a:hover{background:rgba(255,255,255,.12)}
    #clock{
      margin-top:auto;
      padding:12px 18px;
      text-align:center;
      font-weight:600;
      font-size:.95rem;
      border-top:1px solid rgba(255,255,255,.15);
      color:white;
      opacity:.85;
    }   

    /* deslocar conteúdo */
    .desktop-layout header, .desktop-layout main, .desktop-layout footer{margin-left:200px}

    .desktop-layout header{
      background:var(--graphite); color:#fff;
      padding:28px 20px 22px;
    }
    .desktop-layout header h1{margin:0 0 8px; font-weight:800}
    .desktop-layout header .legal{margin-top:10px; font-size:.95rem; line-height:1.35; opacity:.94}

    .desktop-layout main{
      max-width:1100px;
      margin:24px auto 48px;  
      padding:0 16px;
    }
    .card{
      background:var(--card); border-radius:18px; border:1px solid var(--line);
      box-shadow:0 10px 25px rgba(2,12,27,.06); padding:18px 18px 12px;
    }
    .grid{display:grid; grid-template-columns:1.1fr 1fr .9fr; gap:12px}
    .field{display:flex; flex-direction:column; gap:6px}
    label{font-size:.92rem; color:#4a4743; font-weight:600}
    input[type="date"], select, input[type="number"]{
      width:100%; padding:12px 14px; border:1px solid #e5e1db; border-radius:12px; font-size:1rem;
      background:#fff; outline:none;
    }

    .actions{display:flex; align-items:center; gap:8px; flex-wrap:wrap}

    .btn{
      padding:12px 14px; border-radius:12px; cursor:pointer; font-weight:700;
      border:1px solid transparent; letter-spacing:.25px;
    }
    .btn.primary{background:var(--graphite); color:#fff;}
    .btn.secondary{background:var(--sepia); color:#fff;}
    .btn.ghost{background:transparent; border:1px solid #d6d0c7; color:var(--ink)}
    .btn:hover{transform:translateY(-1px)}

    .chips{display:flex; gap:8px; flex-wrap:wrap}
    .chip{
      padding:8px 10px; background:transparent; border:1px solid #d6d0c7;
      border-radius:999px; font-weight:700; cursor:pointer; font-size:.93rem;
    }
    .chip:hover{background:var(--paper-3)}
    .chip[data-d="5"]{border-color:var(--ash); color:var(--ash)}
    .chip[data-d="15"]{border-color:var(--useful); color:var(--useful)}
    .chip[data-d="30"]{border-color:var(--useful); color:var(--ash)}

    .final-date{margin:16px 0 6px; padding:14px 16px; background:var(--hl);
      border:1px dashed var(--line-2); border-radius:12px; font-weight:800;}
    table{width:100%; border-collapse:separate; border-spacing:0; margin-top:12px; font-size:.95rem}
    thead th{position:sticky; top:0; background:#fff; z-index:2; padding:10px 12px; border-bottom:1px solid var(--line);}
    tbody td{padding:10px 12px; border-bottom:1px dashed #e7e2da}
    tbody tr:nth-child(odd){background:var(--row)}
    tbody tr:nth-child(even){background:var(--row2)}

    .tag{padding:4px 8px; border-radius:999px; font-weight:700; font-size:.82rem; display:inline-block; border:1px solid transparent;}
    .tag.ok{background:rgba(77,107,77,.1); color:var(--useful); border-color:rgba(77,107,77,.25)}
    .tag.warn{background:rgba(122,111,97,.1); color:var(--holiday); border-color:rgba(122,111,97,.25)}
    .tag.recesso{background:rgba(106,31,31,.1); color:var(--recess); border-color:rgba(106,31,31,.25)}
    .tag.info{background:rgba(138,109,59,.1); color:var(--ash); border-color:rgba(138,109,59,.25)}

    .desktop-layout footer{max-width:1100px; margin:24px auto 60px; padding:0 16px; color:#6b655d; font-size:.9rem}
    .code{padding:2px 6px; border-radius:6px; border:1px solid var(--line); background:#f4f1eb}
    .danger{color:var(--recess); font-weight:800}

    /* ===== LAYOUT MOBILE ===== */
    .mobile-layout {
      display: none;
    }

    /* Header responsivo */
    .mobile-layout header{
      background:var(--graphite); color:#fff;
      padding:20px 16px;
      position:sticky;
      top:0;
      z-index:20;
      box-shadow:0 2px 10px rgba(0,0,0,.15);
    }
    .mobile-layout header h1{
      margin:0 0 8px; 
      font-weight:800;
      font-size:1.4rem;
    }
    .mobile-layout header .legal{
      margin-top:10px; 
      font-size:.9rem; 
      line-height:1.35; 
      opacity:.94;
    }
    .legal-toggle{
      display:inline-block;
      margin-top:8px;
      padding:6px 10px;
      background:rgba(255,255,255,.15);
      border-radius:6px;
      font-size:.85rem;
      cursor:pointer;
    }

    /* Menu móvel */
    #mobile-menu{
      position:fixed;
      bottom:0;
      left:0;
      right:0;
      background:var(--graphite);
      display:flex;
      justify-content:space-around;
      padding:10px 0;
      z-index:30;
      box-shadow:0 -2px 10px rgba(0,0,0,.15);
    }
    #mobile-menu a, #mobile-menu button{
      display:flex;
      flex-direction:column;
      align-items:center;
      background:none;
      border:none;
      color:white;
      font-size:.8rem;
      padding:8px 12px;
      text-decoration:none;
      border-radius:8px;
      transition:background .2s;
    }
    #mobile-menu a:hover, #mobile-menu button:hover{
      background:rgba(255,255,255,.12);
    }
    #mobile-menu .icon{
      font-size:1.2rem;
      margin-bottom:4px;
    }

    .mobile-layout main{
      max-width:100%;
      margin:0 auto 80px;  
      padding:16px;
    }
    
    .mobile-grid{
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    
    .mobile-field{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    
    .mobile-layout input[type="date"], .mobile-layout select, .mobile-layout input[type="number"]{
      width:100%; 
      padding:14px 16px; 
      border:1px solid #e5e1db; 
      border-radius:12px; 
      font-size:1rem;
      background:#fff; 
      outline:none;
      -webkit-appearance:none;
      min-height:50px;
    }

    .mobile-actions{
      display:flex; 
      flex-direction:column;
      gap:12px; 
      margin-top:16px;
    }

    .mobile-btn{
      padding:14px 18px; 
      border-radius:12px; 
      cursor:pointer; 
      font-weight:700;
      border:1px solid transparent; 
      letter-spacing:.25px;
      font-size:1rem;
      min-height:50px;
      display:flex;
      align-items:center;
      justify-content:center;
      flex:1;
    }
    .mobile-btn.primary{background:var(--graphite); color:#fff;}
    .mobile-btn.secondary{background:var(--sepia); color:#fff;}
    .mobile-btn.ghost{background:transparent; border:1px solid #d6d0c7; color:var(--ink)}

    .mobile-chips{
      display:flex; 
      gap:8px; 
      flex-wrap:wrap;
      justify-content:center;
    }
    .mobile-chip{
      padding:12px 14px; 
      background:transparent; 
      border:1px solid #d6d0c7;
      border-radius:999px; 
      font-weight:700; 
      cursor:pointer; 
      font-size:.93rem;
      min-width:60px;
      text-align:center;
    }
    .mobile-chip:hover{background:var(--paper-3)}
    .mobile-chip[data-d="5"]{border-color:var(--ash); color:var(--ash)}
    .mobile-chip[data-d="15"]{border-color:var(--useful); color:var(--useful)}
    .mobile-chip[data-d="30"]{border-color:var(--useful); color:var(--ash)}

    .mobile-final-date{
      margin:16px 0 12px; 
      padding:16px; 
      background:var(--hl);
      border:1px dashed var(--line-2); 
      border-radius:12px; 
      font-weight:800;
      font-size:1.1rem;
      text-align:center;
    }
    
    /* Tabela responsiva */
    .table-container{
      max-height:400px; 
      overflow:auto; 
      margin-top:12px; 
      border:1px solid var(--line); 
      border-radius:12px; 
      background:#fff;
    }
    
    .mobile-layout table{
      width:100%; 
      border-collapse:separate; 
      border-spacing:0; 
      font-size:.95rem;
      min-width:600px;
    }
    
    .mobile-layout thead th{
      position:sticky; 
      top:0; 
      background:#fff; 
      z-index:2; 
      padding:12px 10px; 
      border-bottom:1px solid var(--line);
      font-size:.9rem;
    }
    
    .mobile-layout tbody td{
      padding:12px 10px; 
      border-bottom:1px dashed #e7e2da;
      font-size:.9rem;
    }

    .mobile-layout footer{
      max-width:100%; 
      margin:24px auto 100px; 
      padding:0 16px; 
      color:#6b655d; 
      font-size:.9rem;
    }

    /* Modal para informações legais */
    .modal{
      display:none;
      position:fixed;
      top:0;
      left:0;
      right:0;
      bottom:0;
      background:rgba(0,0,0,.7);
      z-index:40;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .modal-content{
      background:var(--card);
      border-radius:16px;
      padding:24px;
      max-width:500px;
      width:100%;
      max-height:80vh;
      overflow-y:auto;
    }
    .modal-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:16px;
    }
    .modal-close{
      background:none;
      border:none;
      font-size:1.5rem;
      cursor:pointer;
      color:var(--sepia);
    }

    /* Mostrar layout correto baseado no dispositivo */
    @media (min-width: 768px) {
      .desktop-layout {
        display: block;
      }
      .mobile-layout {
        display: none !important;
      }
    }

    @media (max-width: 767px) {
      .desktop-layout {
        display: none !important;
      }
      .mobile-layout {
        display: block;
      }
    }
  </style>
</head>
<body>

<!-- ===== LAYOUT DESKTOP ===== -->
<div class="desktop-layout">
  <div id="sidebar-back">
    <a href="index.html">⬅ Voltar ao Início</a>
    <div id="clock"></div>
  </div>

  <header>
    <h1>Contador de Prazos Cíveis — TJGO</h1>
    <p class="legal">
      <strong>Leitura</strong>: contagem no primeiro dia útil subsequente.<br>
      <strong>Expedição</strong>: D1/D2; contagem no dia útil subsequente à publicação (D2).<br>
      <strong>Quarta-Feira de Cinzas (QF)</strong>: não se inicia nem termina; conta-se durante o curso.<br>
      <strong>Recesso</strong>: 20/12 a 20/01 (inclusive); aplica-se somente dia útil.
    </p>
  </header>

  <main>
    <section class="card">
      <div class="grid">
        <div class="field">
          <label for="tipo-desktop">Tipo de marco inicial</label>
          <select id="tipo-desktop">
            <option value="leitura">Leitura (intimação lida)</option>
            <option value="expedicao">Expedição (Dia em que o ato foi gerado no Projudi)</option>
          </select>
        </div>

        <div class="field">
          <label for="dataBase-desktop">Data Inicial</label>
          <input type="date" id="dataBase-desktop" />
        </div>

        <div class="field">
          <label for="dias-desktop">Dias de prazo (dias úteis)</label>
          <input type="number" id="dias-desktop" min="1" step="1" value="15"/>
        </div>
      </div>

      <div class="actions" style="margin-top:12px">
        <button class="btn primary" id="btnCalcular-desktop">Calcular prazo</button>
        <div class="chips">
          <button class="chip" data-d="5">5 dias</button>
          <button class="chip" data-d="15">15 dias</button>
          <button class="chip" data-d="30">30 dias</button>
        </div>
        <span class="muted">Feriados TJGO (2023–2026), recesso (20/12–20/01), fins de semana e Quarta-feira de Cinzas com regra especial já aplicados.</span>
      </div>

      <div class="result" id="resultado-desktop" style="display:none">
        <div class="final-date" id="finalDate-desktop"></div>
        <div class="toolbar">
          <button class="btn secondary" id="btnCopiar-desktop">Copiar resumo</button>
          <button class="btn ghost" id="btnCSV-desktop">Exportar CSV</button>
        </div>
        <div style="max-height:430px; overflow:auto; margin-top:6px; border:1px solid var(--line); border-radius:12px; background:#fff">
          <table id="tabela-desktop">
            <thead>
              <tr>
                <th>#</th>
                <th>Data</th>
                <th>Dia da semana</th>
                <th>Classificação</th>
                <th>Observação</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <p class="muted small">Planilha de auditoria contínua: todos os dias entre o marco e a data final são listados, com justificativa quando não contados.</p>
      </div>
    </section>
  </main>

  <footer class="small">
    <p><strong>Fontes oficiais:</strong> Feriados do Tribunal de Justiça do Estado de Goiás (2023–2026) e Recesso Forense, conforme calendários publicados. Este utilitário não substitui a conferência oficial nos autos e normativos aplicáveis.</p>
  </footer>
</div>

<!-- ===== LAYOUT MOBILE ===== -->
<div class="mobile-layout">
  <header>
    <h1>Contador de Prazos Cíveis — TJGO</h1>
    <p class="legal">
      <strong>Leitura</strong>: contagem no primeiro dia útil subsequente.<br>
      <strong>Expedição</strong>: D1/D2; contagem no dia útil subsequente à publicação (D2).<br>
      <strong>Quarta-Feira de Cinzas (QF)</strong>: não se inicia nem termina; conta-se durante o curso.<br>
      <strong>Recesso</strong>: 20/12 a 20/01 (inclusive); aplica-se somente dia útil.
    </p>
    <div class="legal-toggle" id="toggleLegal">ℹ️ Mais informações</div>
  </header>

  <main>
    <section class="card">
      <div class="mobile-grid">
        <div class="mobile-field">
          <label for="tipo-mobile">Tipo de marco inicial</label>
          <select id="tipo-mobile">
            <option value="leitura">Leitura (intimação lida)</option>
            <option value="expedicao">Expedição (Dia em que o ato foi gerado no Projudi)</option>
          </select>
        </div>

        <div class="mobile-field">
          <label for="dataBase-mobile">Data Inicial</label>
          <input type="date" id="dataBase-mobile" />
        </div>

        <div class="mobile-field">
          <label for="dias-mobile">Dias de prazo (dias úteis)</label>
          <input type="number" id="dias-mobile" min="1" step="1" value="15"/>
        </div>
      </div>

      <div class="mobile-actions">
        <button class="mobile-btn primary" id="btnCalcular-mobile">Calcular prazo</button>
        <div class="mobile-chips">
          <button class="mobile-chip" data-d="5">5 dias</button>
          <button class="mobile-chip" data-d="15">15 dias</button>
          <button class="mobile-chip" data-d="30">30 dias</button>
        </div>
      </div>
      <div style="margin-top:12px; font-size:.9rem; color:#7a6f61; text-align:center;">
        Feriados TJGO (2023–2026), recesso (20/12–20/01), fins de semana e Quarta-feira de Cinzas com regra especial já aplicados.
      </div>

      <div class="result" id="resultado-mobile" style="display:none">
        <div class="mobile-final-date" id="finalDate-mobile"></div>
        <div class="mobile-actions">
          <button class="mobile-btn secondary" id="btnCopiar-mobile">Copiar resumo</button>
          <button class="mobile-btn ghost" id="btnCSV-mobile">Exportar CSV</button>
        </div>
        <div class="table-container">
          <table id="tabela-mobile">
            <thead>
              <tr>
                <th>#</th>
                <th>Data</th>
                <th>Dia</th>
                <th>Tipo</th>
                <th>Observação</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <p style="margin-top:12px; font-size:.85rem; color:#7a6f61; text-align:center;">
          Planilha de auditoria contínua: todos os dias entre o marco e a data final são listados, com justificativa quando não contados.
        </p>
      </div>
    </section>
  </main>

  <footer>
    <p><strong>Fontes oficiais:</strong> Feriados do Tribunal de Justiça do Estado de Goiás (2023–2026) e Recesso Forense, conforme calendários publicados. Este utilitário não substitui a conferência oficial nos autos e normativos aplicáveis.</p>
  </footer>

  <!-- Menu móvel -->
  <div id="mobile-menu">
    <a href="index.html">
      <span class="icon">🏠</span>
      <span>Início</span>
    </a>
    <button id="mobileCalc">
      <span class="icon">📅</span>
      <span>Calcular</span>
    </button>
    <button id="mobileCopy">
      <span class="icon">📋</span>
      <span>Copiar</span>
    </button>
    <button id="mobileExport">
      <span class="icon">📤</span>
      <span>Exportar</span>
    </button>
  </div>
</div>

<!-- Modal para informações legais -->
<div class="modal" id="legalModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 style="margin:0;">Informações Legais</h2>
      <button class="modal-close" id="closeModal">&times;</button>
    </div>
    <div>
      <p><strong>Leitura</strong>: contagem no primeiro dia útil subsequente.</p>
      <p><strong>Expedição</strong>: D1/D2; contagem no dia útil subsequente à publicação (D2).</p>
      <p><strong>Quarta-Feira de Cinzas (QF)</strong>: não se inicia nem termina; conta-se durante o curso.</p>
      <p><strong>Recesso</strong>: 20/12 a 20/01 (inclusive); aplica-se somente dia útil.</p>
      <p><strong>Feriados TJGO</strong>: Incluem feriados nacionais, estaduais e municipais conforme calendário oficial do TJGO.</p>
    </div>
  </div>
</div>

<script>
  // ---------- Utilidades de datas ----------
  const fmtBR = (d)=>{
    const pad = (n)=> String(n).padStart(2,'0');
    return `${pad(d.getDate())}/${pad(d.getMonth()+1)}/${d.getFullYear()}`;
  };
  const diaSemana = (d)=>["Domingo","Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado"][d.getDay()];
  const diaSemanaMobile = (d)=>["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"][d.getDay()];
  const ymd = (d)=>{
    const pad=(n)=> String(n).padStart(2,'0');
    return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
  };
  const parseISO = (s)=>{
    const [Y,M,D] = s.split('-').map(Number);
    const dt = new Date(Date.UTC(Y, M-1, D));
    return new Date(dt.getUTCFullYear(), dt.getUTCMonth(), dt.getUTCDate());
  };
  const addDays = (d, n)=>{
    const nd = new Date(d);
    nd.setDate(nd.getDate()+n);
    return nd;
  };

  // ---------- Base de feriados TJGO (2023-2026) ----------
  const HOLIDAYS = new Map(); // key: 'YYYY-MM-DD' → {name, yearTag}
  const ASH = new Set(); // Quarta-Feira de Cinzas (datas específicas)

  function add(name, dates, {ash=false}={}) {
    dates.forEach(s=> {
      HOLIDAYS.set(s, {name, yearTag: s.slice(0,4)});
      if(ash) ASH.add(s);
    });
  }
  function addRange(name, fromYMD, toYMD){
    let d = parseISO(fromYMD);
    const end = parseISO(toYMD);
    while(d <= end){
      HOLIDAYS.set(ymd(d), {name, yearTag: d.getFullYear().toString()});
      d = addDays(d, 1);
    }
  }

  // 2023
  add("Confraternização Universal (Feriado Nacional)", ["2023-01-01"]);
  add("Carnaval (Feriado no Tribunal e em todas as comarcas)", ["2023-02-20","2023-02-21"]);
  add("Quarta-feira de Cinzas (regra especial)", ["2023-02-22"], {ash:true});
  add("Semana Santa — Feriado no Tribunal", ["2023-04-05","2023-04-06"]);
  add("Paixão de Cristo (Feriado Nacional)", ["2023-04-07"]);
  add("Tiradentes (Feriado Nacional)", ["2023-04-21"]);
  add("Dia do Trabalho (Feriado Nacional)", ["2023-05-01"]);
  add("Nossa Senhora Auxiliadora (Feriado Municipal: Goiânia, Iporá, Leopoldo de Bulhões, Senador Canedo)", ["2023-05-24"]);
  add("Corpus Christi (Feriado Nacional)", ["2023-06-08"]);
  add("Fundação da Cidade de Goiás (Feriado no Tribunal)", ["2023-07-26"]);
  add("Independência do Brasil (Feriado Nacional)", ["2023-09-07"]);
  add("Nossa Senhora Aparecida (Feriado Nacional)", ["2023-10-12"]);
  add("Comemorativo pedra fundamental/Aniversário de Goiânia (Feriado no Tribunal)", ["2023-10-24"]);
  add("Dia do Servidor Público (Feriado Estadual)", ["2023-10-28"]);
  add("Finados (Feriado Nacional)", ["2023-11-02"]);
  add("Proclamação da República (Feriado Nacional)", ["2023-11-15"]);
  add("Dia da Justiça (Feriado no Tribunal)", ["2023-12-08"]);
  add("Natal (Feriado Nacional)", ["2023-12-25"]);
  addRange("Recesso Forense", "2023-12-20", "2024-01-20");

  // 2024
  add("Ano Novo (Feriado Nacional)", ["2024-01-01"]);
  add("Carnaval (Feriado no Tribunal e em todas as comarcas)", ["2024-02-12","2024-02-13"]);
  add("Quarta-feira de Cinzas (regra especial)", ["2024-02-14"], {ash:true});
  add("Semana Santa — Feriado no Tribunal", ["2024-03-27","2024-03-28","2024-03-29"]);
  add("Dia do Trabalho (Feriado Nacional)", ["2024-05-01"]);
  add("Nossa Senhora Auxiliadora (Feriado Municipal: TJ/Comarcas específicas)", ["2024-05-24"]);
  add("Corpus Christi (Feriado Nacional)", ["2024-05-30"]);
  add("Ponto Facultativo — PJ estadual", ["2024-05-31"]);
  add("Fundação da Cidade de Goiás (feriado de 26/07 alterado para 22/07)", ["2024-07-22"]);
  add("Aniversário de Goiânia (Feriado no Tribunal e em todas as comarcas)", ["2024-10-24"]);
  add("Dia do Servidor Público (feriado do dia 28/10 alterado para 01/11)", ["2024-11-01"]);
  add("Proclamação da República (Feriado Nacional)", ["2024-11-15"]);
  add("Dia da Consciência Negra (Feriado Nacional)", ["2024-11-20"]);
  add("Natal (Feriado Nacional)", ["2024-12-25"]);
  addRange("Recesso Forense", "2024-12-20", "2025-01-20");

  // 2025
  add("Ano Novo (Feriado Nacional)", ["2025-01-01"]);
  add("Carnaval (Feriado no Tribunal e em todas as comarcas)", ["2025-03-03","2025-03-04"]);
  add("Quarta-feira de Cinzas (regra especial)", ["2025-03-05"], {ash:true});
  add("Semana Santa — Feriado no Tribunal", ["2025-04-16","2025-04-17","2025-04-18"]);
  add("Tiradentes (Feriado Nacional)", ["2025-04-21"]);
  add("Dia do Trabalho (Feriado Nacional)", ["2025-05-01"]);
  add("Nossa Senhora Auxiliadora (Feriado Municipal: TJ/Comarcas específicas)", ["2025-05-24"]);
  add("Corpus Christi (Feriado Nacional)", ["2025-06-19"]);
  add("Fundação da Cidade de Goiás (Feriado no Tribunal)", ["2025-07-26"]);
  add("Independência do Brasil (Feriado Nacional)", ["2025-09-07"]);
  add("Nossa Senhora Aparecida (Feriado Nacional)", ["2025-10-12"]);
  add("Aniversário de Goiânia (Feriado no Tribunal e em todas as comarcas)", ["2025-10-24"]);
  add("Dia do Servidor Público (Feriado Estadual)", ["2025-10-28"]);
  add("Finados (Feriado Nacional)", ["2025-11-02"]);
  add("Proclamação da República (Feriado Nacional)", ["2025-11-15"]);
  add("Dia da Consciência Negra (Feriado Nacional)", ["2025-11-20"]);
  add("Dia da Justiça (Feriado — Art. 123 RITJGO)", ["2025-12-08"]);
  add("Natal (Feriado Nacional)", ["2025-12-25"]);
  addRange("Recesso Forense", "2025-12-20", "2026-01-20");

  // 2026 (incluso para cobertura)
  add("Ano Novo (Feriado Nacional)", ["2026-01-01"]);
  add("Carnaval (Feriado no Tribunal e em todas as comarcas)", ["2026-02-16","2026-02-17"]);
  add("Quarta-feira de Cinzas (regra especial)", ["2026-02-18"], {ash:true});
  add("Semana Santa — Feriado no Tribunal", ["2026-04-03","2026-04-04","2026-04-05"]);
  add("Tiradentes (Feriado Nacional)", ["2026-04-21"]);
  add("Dia do Trabalho (Feriado Nacional)", ["2026-05-01"]);
  addRange("Recesso Forense", "2026-12-20", "2027-01-20"); // apenas placeholder caso necessário

  // ---------- Helpers ----------
  function isWeekend(d){ const g = d.getDay(); return g===0 || g===6; }
  function isAshWednesday(d){ return ASH.has(ymd(d)); }
  function holidayInfo(d){ const k=ymd(d); return HOLIDAYS.get(k) || null; }

  // mode: 'counting' (contagem em curso, QF conta) | 'start_end' (início/fim, QF bloqueia)
  function isHoliday(d, mode='counting'){
    const info = holidayInfo(d);
    if(info){
      if(isAshWednesday(d)){
        return mode === 'start_end' ? info : null;
      }
      return info;
    }
    return null;
  }

  function isBusinessDay(d, mode='counting'){
    if(isWeekend(d)) return false;
    const h = isHoliday(d, mode);
    if(h) return false;
    return true;
  }
  function nextBusinessDay(d, mode='counting'){
    let cur = new Date(d);
    while(!isBusinessDay(cur, mode)) cur = addDays(cur,1);
    return cur;
  }

  function reasonNonUseful(d, mode='counting'){
    // Prioridade: Recesso > Feriado > QF(start_end) > Fim de semana
    const h = holidayInfo(d);
    if(h){
      if(h.name.toLowerCase().includes('recesso')) return 'Recesso forense';
      if(isAshWednesday(d) && mode==='start_end') return 'QF — não inicia/não finaliza';
      return `Feriado — ${h.name}`;
    }
    if(isWeekend(d)) return 'Fim de semana';
    if(isAshWednesday(d) && mode==='start_end') return 'QF — não inicia/não finaliza';
    return '';
  }

  function classifyDay(d, mode='counting', isMobile = false){
    const obj = {date: new Date(d), dow: isMobile ? diaSemanaMobile(d) : diaSemana(d), tag: '', badge:'', obs:[], final:false};

    // Fim de semana
    if(isWeekend(d)){
      obj.tag='Não útil'; obj.badge='warn';
      obj.obs.push('Fim de semana');
      return obj;
    }

    // Feriados e recesso
    const h = isHoliday(d, mode);
    if(h){
      const isRec = h.name.toLowerCase().includes('recesso');
      obj.tag = isRec ? 'Recesso' : 'Não útil';
      obj.badge = isRec ? 'recesso' : 'warn';
      obj.obs.push(isRec ? 'Recesso forense' : h.name);
      if(isAshWednesday(d) && mode==='start_end'){ obj.obs = ['QF — não inicia/não finaliza']; obj.badge='info'; }
      return obj;
    }

    // Quarta-feira de Cinzas — durante contagem é útil
    if(isAshWednesday(d) && mode==='counting'){
      obj.tag='Útil'; obj.badge='info'; obj.obs.push('QF — contado (contagem em curso)');
      return obj;
    }

    obj.tag='Útil'; obj.badge='ok';
    return obj;
  }

  // Conta N dias úteis; aplica prorrogação se final cair em QF (não pode finalizar)
  function addBusinessDays(start, n, firstDayNote=null){
    let cur = new Date(start);
    let count = 0;
    const counted = new Map(); // ymd -> obs array
    while(count < n){
      cur = addDays(cur, 1);
      if(isBusinessDay(cur, 'counting')){
        count++;
        const obs = [`Dia útil de contagem #${count}`];
        if(count === 1 && firstDayNote){ obs[0] += ` (${firstDayNote})`; }
        if(count === n){ obs.push('Data teórica final do prazo'); }
        counted.set(ymd(cur), obs);
      }
    }
    // Se final cair em QF (start_end), prorroga para próximo útil
    if(isAshWednesday(cur)){
      const key = ymd(cur);
      if(counted.has(key)) counted.get(key).push('QF — não finaliza; prorrogado');
      let bump = nextBusinessDay(addDays(cur,1), 'start_end');
      counted.set(ymd(bump), ['Prorrogação da final por QF → Data final']);
      cur = bump;
    } else {
      const key = ymd(cur);
      if(counted.has(key)) counted.get(key).push('Data final do prazo');
      else counted.set(key, ['Data final do prazo']);
    }
    return {end: cur, counted};
  }

  // ---------- Regras específicas para publicação (D1/D2) ----------
  function isRecessDay(d){
    const h = holidayInfo(d);
    return !!(h && h.name.toLowerCase().includes('recesso'));
  }

  // Mapa de observações de publicação (datas → array de anotações)
  function pushNote(map, d, txt){
    const k = ymd(d);
    if(!map.has(k)) map.set(k, []);
    map.get(k).push(txt);
  }

  // Próximo dia de publicação a partir do dia anterior (marco ou D1)
  // Regra híbrida: aceita dia útil normal OU dia útil de recesso; rejeita FDS e feriado não-recesso
  function nextPublicationFrom(prevDate, pubIndex, pubLog){
    let d = addDays(prevDate, 1);
    while(true){
      const wknd = isWeekend(d);
      const h = holidayInfo(d);
      const rec = isRecessDay(d);

      // Sábado/Domingo sempre rejeitados para publicação (mesmo se dentro do recesso)
      if(wknd){
        // Observação jurídica padronizada
        pushNote(pubLog, d, 'ato de publicação não se realiza em finais de semana.');
        d = addDays(d, 1);
        continue;
      }

      // Feriado não-recesso rejeitado
      if(h && !rec && !isAshWednesday(d)){
        pushNote(pubLog, d, `ato de publicação não se realiza em feriados — ${h.name}.`);
        d = addDays(d, 1);
        continue;
      }

      // Se chegou aqui: dia útil normal OU dia útil de recesso OU QF (tratada abaixo)
      // Observações de aceitação: registrar Publicação Dn
      pushNote(pubLog, d, `Publicação D${pubIndex} (${pubIndex===1 ? '1º' : '2º'} dia útil após expedição)`);
      return d;
    }
  }

  // ---------- Função principal de cálculo ----------
  function calcularPrazo(isMobile = false) {
    const prefix = isMobile ? '-mobile' : '-desktop';
    const tipo = document.getElementById(`tipo${prefix}`).value;
    const sData = document.getElementById(`dataBase${prefix}`).value;
    const nDias = parseInt(document.getElementById(`dias${prefix}`).value, 10);
    if(!sData || isNaN(nDias) || nDias<=0){
      alert('Informe a Data Inicial e um número válido de dias.');
      return;
    }

    const marco = parseISO(sData);
    let D1=null, D2=null, inicioContagem=null, firstNote=null;

    // PUB_NOTES guarda candidaturas rejeitadas/aceitas para auditoria
    const PUB_NOTES = new Map();

    if(tipo === 'leitura'){
      inicioContagem = nextBusinessDay(addDays(marco,1), 'start_end');
      firstNote = '1º dia útil após leitura';
    } else {
      // Regras híbridas para D1/D2 com auditoria de candidatos rejeitados
      D1 = nextPublicationFrom(marco, 1, PUB_NOTES);
      D2 = nextPublicationFrom(D1,    2, PUB_NOTES);

      // Início da contagem: 1º dia útil após D2 (respeitando recesso, feriados, QF)
      inicioContagem = nextBusinessDay(addDays(D2,1), 'start_end');
      firstNote = 'dia útil subsequente à publicação D2';
    }

    const {end: dataFinal, counted} = addBusinessDays(addDays(inicioContagem,-1), nDias, firstNote);

    // --- Montar auditoria contínua ---
    const tbody = document.querySelector(`#tabela${prefix} tbody`);
    tbody.innerHTML = '';
    let idx = 0;

    let cursor = new Date(marco);
    const endInclusive = new Date(dataFinal);

    while(cursor <= endInclusive){
      idx++;
      const key = ymd(cursor);
      const isMarco = (key === ymd(marco));
      let mode = (cursor < inicioContagem) ? 'start_end' : 'counting';

      const base = classifyDay(cursor, mode, isMobile);
      const obsParts = [];

      // Observação base para não útil (prioridade)
      if(base.tag === 'Não útil'){
        let reason = reasonNonUseful(cursor, mode);
        if(isMarco){
          const marcoTxt = (tipo==='leitura')?'Dia da leitura':'Dia da expedição';
          const isRecesso = (reason.toLowerCase().includes('recesso'));
          if(isRecesso){
            reason = 'Recesso forense — ' + marcoTxt;
            obsParts.push(reason);
          } else {
            obsParts.push(marcoTxt);
          }
        } else {
          obsParts.push(reason);
        }
      }

      // D1 / D2 (publicação): notas detalhadas (inclui candidatos rejeitados)
      if(PUB_NOTES && PUB_NOTES.has(key)){
        obsParts.push(...PUB_NOTES.get(key));
      }

      // Dias úteis contados
      if(counted.has(key)){
        base.tag = 'Útil'; base.badge='ok';
        obsParts.push(...counted.get(key));
      }else{
        //
      }

      // Render
      const tr = document.createElement('tr');
      const tdIdx = document.createElement('td'); tdIdx.textContent = idx;
      const tdData = document.createElement('td'); tdData.textContent = fmtBR(base.date);
      const tdDow  = document.createElement('td'); tdDow.textContent = base.dow;

      // badge: ok | warn | recesso | info
      const tdTag  = document.createElement('td'); tdTag.innerHTML = `<span class="tag ${base.badge}">${base.tag}</span>`;
      const tdObs  = document.createElement('td'); tdObs.textContent = obsParts.join(' • ');
      tr.append(tdIdx, tdData, tdDow, tdTag, tdObs);

      if(key === ymd(dataFinal)) tr.style.outline = '2px solid var(--bad)';
      tbody.appendChild(tr);

      cursor = addDays(cursor,1);
    }

    document.getElementById(`finalDate${prefix}`).innerHTML =
      `Prazo de <span class="code">${nDias}</span> dias úteis — <strong>data final:</strong> <span class="danger">${fmtBR(dataFinal)}</span>`;
    document.getElementById(`resultado${prefix}`).style.display = 'block';

    // Copiar resumo / CSV
    document.getElementById(`btnCopiar${prefix}`).onclick = ()=>{
      const resumo = [
        `Tipo: ${tipo === 'leitura' ? 'Leitura' : 'Expedição'}`,
        `Data Inicial: ${fmtBR(marco)}`,
        `Dias de prazo: ${nDias}`,
        `Data final: ${fmtBR(dataFinal)}`
      ].join('\n');
      navigator.clipboard.writeText(resumo).then(()=> alert('Resumo copiado.'));
    };

    document.getElementById(`btnCSV${prefix}`).onclick = ()=>{
      const linhas = [["#", "Data", "Dia da semana", "Classificação", "Observação"]];
      const trs = document.querySelectorAll(`#tabela${prefix} tbody tr`);
      trs.forEach(tr=>{
        const tds = tr.querySelectorAll('td');
        const cols = [tds[0].textContent, tds[1].textContent, tds[2].textContent, tds[3].innerText, tds[4].textContent];
        linhas.push(cols);
      });
      const csv = linhas.map(cols=> cols.map(col=> `"${String(col).replaceAll('"','""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'auditoria_prazo.csv';
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    };
  }

  // ---------- Inicialização ----------
  
  // Desktop
  document.querySelectorAll('.desktop-layout .chip').forEach(ch => {
    ch.addEventListener('click', ()=>{
      document.getElementById('dias-desktop').value = ch.dataset.d;
    });
  });

  document.getElementById('btnCalcular-desktop').addEventListener('click', ()=>{
    calcularPrazo(false);
  });

  // Mobile
  document.querySelectorAll('.mobile-layout .mobile-chip').forEach(ch => {
    ch.addEventListener('click', ()=>{
      document.getElementById('dias-mobile').value = ch.dataset.d;
    });
  });

  document.getElementById('btnCalcular-mobile').addEventListener('click', ()=>{
    calcularPrazo(true);
  });

  // Menu móvel - funcionalidades
  document.getElementById('mobileCalc').addEventListener('click', ()=>{
    calcularPrazo(true);
  });
  document.getElementById('mobileCopy').addEventListener('click', ()=>{
    document.getElementById('btnCopiar-mobile').click();
  });
  document.getElementById('mobileExport').addEventListener('click', ()=>{
    document.getElementById('btnCSV-mobile').click();
  });

  // Modal para informações legais
  document.getElementById('toggleLegal').addEventListener('click', ()=>{
    document.getElementById('legalModal').style.display = 'flex';
  });
  document.getElementById('closeModal').addEventListener('click', ()=>{
    document.getElementById('legalModal').style.display = 'none';
  });
  document.getElementById('legalModal').addEventListener('click', (e)=>{
    if(e.target === document.getElementById('legalModal')){
      document.getElementById('legalModal').style.display = 'none';
    }
  });

  // Clock (apenas desktop)
  function updateClock(){
    const now = new Date();
    const hh = String(now.getHours()).padStart(2,'0');
    const mm = String(now.getMinutes()).padStart(2,'0');
    const ss = String(now.getSeconds()).padStart(2,'0');
    const el = document.getElementById('clock');
    if(el) el.textContent = `${hh}:${mm}:${ss}`;
  }
  updateClock();
  setInterval(updateClock,1000);

  // Melhorar a experiência em dispositivos móveis
  // Definir data padrão como hoje
  const today = new Date();
  const todayFormatted = today.toISOString().split('T')[0];
  document.getElementById('dataBase-desktop').value = todayFormatted;
  document.getElementById('dataBase-mobile').value = todayFormatted;
  
  // Melhorar a usabilidade do input de data em mobile
  document.getElementById('dataBase-mobile').addEventListener('focus', function() {
    this.type = 'date';
  });
</script>
  
</body>
</html>
